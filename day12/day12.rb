p IO.read('day12input').gsub(/{(?>[^{}:]+|[^{}]+?|({(?>[^{}]+|\g'1')*}))*:"red(?>[^{}]+|({(?>[^{}]+|\g'2')*}))*}/, '').scan(/-?\d+/).map(&:to_i).reduce(:+)
